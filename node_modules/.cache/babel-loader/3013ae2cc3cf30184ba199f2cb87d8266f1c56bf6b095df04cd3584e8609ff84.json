{"ast":null,"code":"import _defineProperty from\"C:/Users/zied/OneDrive - Ministere de l'Enseignement Superieur et de la Recherche Scientifique/Desktop/reset-password-client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/zied/OneDrive - Ministere de l'Enseignement Superieur et de la Recherche Scientifique/Desktop/reset-password-client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Users/zied/OneDrive - Ministere de l'Enseignement Superieur et de la Recherche Scientifique/Desktop/reset-password-client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/zied/OneDrive - Ministere de l'Enseignement Superieur et de la Recherche Scientifique/Desktop/reset-password-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/zied/OneDrive - Ministere de l'Enseignement Superieur et de la Recherche Scientifique/Desktop/reset-password-client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{useLocation,useNavigate}from'react-router-dom';import queryString from'query-string';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var API_BASE_URL=process.env.API_BASE_URL||'http://localhost:3600/api';function Form(){var Location=useLocation();console.log(Location.search);var _useState=useState(''),_useState2=_slicedToArray(_useState,2),invalidUser=_useState2[0],setinvalidUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),busy=_useState4[0],setBusy=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState({password:'',confirmPassword:''}),_useState8=_slicedToArray(_useState7,2),Newpassword=_useState8[0],setNewpassword=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),success=_useState10[0],setsuccess=_useState10[1];var navigate=useNavigate();var _queryString$parse=queryString.parse(Location.search),token=_queryString$parse.token,id=_queryString$parse.id;var verifyToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$axios,data,_error$response,_data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios(\"\".concat(API_BASE_URL,\"/verify-token?token=\").concat(token,\"&id=\").concat(id));case 3:_yield$axios=_context.sent;data=_yield$axios.data;setBusy(false);_context.next=17;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);if(!(_context.t0!==null&&_context.t0!==void 0&&(_error$response=_context.t0.response)!==null&&_error$response!==void 0&&_error$response.data)){_context.next=16;break;}_data=_context.t0.response.data;if(_data.success){_context.next=14;break;}return _context.abrupt(\"return\",setinvalidUser(_data.error));case 14:return _context.abrupt(\"return\",console.log(_context.t0.response.data));case 16:console.log(_context.t0);case 17:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function verifyToken(){return _ref.apply(this,arguments);};}();useEffect(function(){verifyToken();},[]);var handleOnChange=function handleOnChange(_ref2){var target=_ref2.target;setNewpassword(_objectSpread(_objectSpread({},Newpassword),{},_defineProperty({},target.name,target.value)));console.log(target);};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var password,confirmPassword,_yield$axios$post,data,_error$response2,_data2;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:// setError(false)\ne.preventDefault();password=Newpassword.password,confirmPassword=Newpassword.confirmPassword;if(!(password.trim().length<8||password.trim().length>20)){_context2.next=4;break;}return _context2.abrupt(\"return\",setError('Password must be between 8 and 20 characters'));case 4:if(!(password!==confirmPassword)){_context2.next=6;break;}return _context2.abrupt(\"return\",setError('Passwords do not match'));case 6:if(!(password.trim().length<8)){_context2.next=8;break;}return _context2.abrupt(\"return\",setError('Password must be at least 8 characters'));case 8:_context2.prev=8;setBusy(true);_context2.next=12;return axios.post(\"\".concat(API_BASE_URL,\"/reset-password?token=\").concat(token,\"&id=\").concat(id),{password:password});case 12:_yield$axios$post=_context2.sent;data=_yield$axios$post.data;setBusy(false);console.log(data);if(data.success){navigate('/reset-password');setsuccess(true);}_context2.next=28;break;case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](8);setBusy(false);if(!(_context2.t0!==null&&_context2.t0!==void 0&&(_error$response2=_context2.t0.response)!==null&&_error$response2!==void 0&&_error$response2.data)){_context2.next=27;break;}_data2=_context2.t0.response.data;if(_data2.success){_context2.next=26;break;}return _context2.abrupt(\"return\",setError(_data2.error));case 26:return _context2.abrupt(\"return\",console.log(_context2.t0.response.data));case 27:console.log(_context2.t0);case 28:case\"end\":return _context2.stop();}},_callee2,null,[[8,19]]);}));return function handleSubmit(_x){return _ref3.apply(this,arguments);};}();if(invalidUser)return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-screen-sm m-auto pt-40\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-center text-3xl text-gray-500 mb-3\",children:invalidUser})});if(busy)return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-screen-sm m-auto pt-40\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-gray-900\"})})});if(success)return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-screen-sm m-auto pt-40\",children:/*#__PURE__*/_jsx(\"h1\",{className:\"text-center text-3xl text-gray-500 mb-3\",children:\"Password Reset Successfully\"})});return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-screen-sm m-auto pt-40\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-center text-3xl text-gray-500 mb-3\",children:\"Reset password\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"shadow w-full rounded-lg p-10\",onSubmit:handleSubmit,children:[error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-center p-2 mb-3 bg-red-500 text-white\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-8\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"password\",placeholder:\"New password\",name:\"password\",onChange:handleOnChange,className:\"px-3 text-lg h-10 w-full border-gray-500 border-2 rounded\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"confirmPassword\",placeholder:\"Confirm password\",onChange:handleOnChange,className:\"px-3 text-lg h-10 w-full border-gray-500 border-2 rounded\"}),/*#__PURE__*/_jsx(\"button\",{className:\"bg-blue-500 text-white text-lg h-10 w-full rounded mt-3\",children:\"Reset password\"})]})]})]});}export default Form;","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","queryString","axios","API_BASE_URL","process","env","Form","Location","console","log","search","invalidUser","setinvalidUser","busy","setBusy","error","setError","password","confirmPassword","Newpassword","setNewpassword","success","setsuccess","navigate","parse","token","id","verifyToken","data","response","handleOnChange","target","name","value","handleSubmit","e","preventDefault","trim","length","post"],"sources":["C:/Users/zied/OneDrive - Ministere de l'Enseignement Superieur et de la Recherche Scientifique/Desktop/reset-password-client/src/components/Form.js"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport { useLocation, useNavigate } from 'react-router-dom'\r\nimport queryString from 'query-string'\r\nimport axios from 'axios'\r\n\r\n\r\n\r\nconst API_BASE_URL = process.env.API_BASE_URL || 'http://localhost:3600/api'\r\nfunction Form() {\r\n  const Location = useLocation()\r\n  console.log(Location.search)\r\n  const [invalidUser, setinvalidUser] = useState('')\r\n  const [busy, setBusy] = useState(true)\r\n  const [error, setError] = useState('')\r\n  const [Newpassword, setNewpassword] = useState({\r\n    password: '',\r\n    confirmPassword: ''\r\n  })\r\n  const [success, setsuccess] = useState(false)\r\n  const navigate = useNavigate()\r\n  \r\n\r\n  const {token, id}= queryString.parse(Location.search)\r\n\r\n  const verifyToken=async ()=> {\r\n    try {\r\n    const {data} = await axios(`${API_BASE_URL}/verify-token?token=${token}&id=${id}`)\r\n    setBusy(false)\r\n\r\n  } catch (error) {\r\n    if(error?.response?.data){\r\n      const {data} = error.response;\r\n      if(!data.success) return setinvalidUser(data.error)\r\n      return console.log(error.response.data)\r\n      setBusy(false)\r\n    }\r\n    console.log(error)\r\n      \r\n  }\r\n\r\n\r\n\r\n  }\r\n  useEffect(() => {\r\n    verifyToken()\r\n  \r\n  }, [])\r\n  const handleOnChange =({target})=>{\r\n    setNewpassword({\r\n      ...Newpassword,\r\n      [target.name]: target.value\r\n    })\r\n    console.log(target)\r\n    \r\n  }\r\n\r\n  const handleSubmit = async(e)=> {\r\n    // setError(false)\r\n    e.preventDefault()\r\n\r\n    const {password, confirmPassword} = Newpassword\r\n    if(password.trim().length <8 || password.trim().length >20 ){\r\n      return setError('Password must be between 8 and 20 characters')\r\n    }\r\n    if(password !== confirmPassword){\r\n      return setError('Passwords do not match')\r\n    }\r\n    if(password.trim().length < 8){\r\n      return setError('Password must be at least 8 characters')\r\n    }\r\n\r\n    try {\r\n      setBusy(true)\r\n    const {data} = await axios.post(`${API_BASE_URL}/reset-password?token=${token}&id=${id}`, {password})\r\n    setBusy(false)\r\n    console.log(data)\r\n    \r\n    if(data.success) {\r\n      \r\n      navigate('/reset-password')\r\n      setsuccess(true)\r\n\r\n    }\r\n\r\n      \r\n    } catch (error) {\r\n      setBusy(false)\r\n      if(error?.response?.data){\r\n        const {data} = error.response;\r\n        if(!data.success) return setError(data.error)\r\n        return console.log(error.response.data)\r\n        }\r\n        console.log(error)\r\n\r\n\r\n      \r\n    }\r\n  } \r\n\r\n  if(invalidUser) return <div className='max-w-screen-sm m-auto pt-40'>\r\n    <h1 className='text-center text-3xl text-gray-500 mb-3' >\r\n      {invalidUser}\r\n    </h1>\r\n  </div>\r\n\r\nif(busy) return <div className='max-w-screen-sm m-auto pt-40'>\r\n  <div className=\"flex justify-center items-center\">\r\n  <div className=\"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-gray-900\"></div>\r\n</div>\r\n</div>\r\n\r\nif(success) return <div className='max-w-screen-sm m-auto pt-40'>\r\n<h1 className='text-center text-3xl text-gray-500 mb-3' >\r\n  Password Reset Successfully\r\n</h1>\r\n</div>\r\n  \r\n  return (\r\n    <div className=\"max-w-screen-sm m-auto pt-40\">\r\n      <h1 className='text-center text-3xl text-gray-500 mb-3' >\r\n        Reset password\r\n      </h1>\r\n      <form className='shadow w-full rounded-lg p-10'\r\n      onSubmit={handleSubmit}\r\n      >\r\n        {error &&  <p className='text-center p-2 mb-3 bg-red-500 text-white'>\r\n            {error}\r\n          </p>}\r\n         <div className='space-y-8'>\r\n\r\n        <input\r\n          type=\"password\"\r\n          placeholder=\"New password\"\r\n          name=\"password\"\r\n          onChange={handleOnChange}\r\n          className='px-3 text-lg h-10 w-full border-gray-500 border-2 rounded'\r\n          />\r\n        <input\r\n          type=\"password\"\r\n          name='confirmPassword'\r\n          placeholder=\"Confirm password\"\r\n          onChange={handleOnChange}\r\n          className='px-3 text-lg h-10 w-full border-gray-500 border-2 rounded'\r\n          />\r\n          \r\n        <button className='bg-blue-500 text-white text-lg h-10 w-full rounded mt-3'>\r\n          Reset password\r\n        </button>\r\n        \r\n\r\n          </div>\r\n      </form>\r\n\r\n\r\n    </div>\r\n    \r\n  )\r\n}\r\n\r\nexport default Form"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}